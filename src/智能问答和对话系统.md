# 智能问答和对话系统

<!-- toc -->

# 智能问答系统

问答系统是信息检索系统的一种高级形式，使用自然语言回答用户的问题。

什么是智能问答系统？智能问答系统有哪些常见应用？

智能问答系统是一种基于人工智能技术的系统，可以根据用户提出的问题自动给出答案。这种系统通过自然语言处理、知识图谱和机器学习等技术，能够理解用户的问题并从大量的数据中找到最合适的答案。

智能问答系统在各个领域都有应用，其中一些常见的应用包括：

1. 搜索引擎中的智能问答功能，比如谷歌的“智能回答”功能，可以直接显示问题的答案而不需要用户点击链接。

2. 个人助理软件，比如苹果的Siri、亚马逊的Alexa和微软的Cortana，可以回答用户提出的问题，执行任务或者提供相关的信息。

3. 在线客服系统，企业可以通过智能问答系统提供自动化的客户服务，快速解答用户的问题。

4. 医疗健康领域，智能问答系统可以提供医疗咨询、疾病诊断等服务，帮助用户更好地了解自己的健康状况。

5. 教育领域，智能问答系统可以为学生提供在线学习的辅助，回答他们的问题并提供相关的学习资源。

总的来说，智能问答系统可以提高工作效率，节省时间，帮助用户更快地获取所需的信息。


## 问答系统分类

问答系统类型：基于问答对、基于知识图谱KBAQ、基于文本、基于表格、基于视觉等

### 基于问答对

什么是问答对？

问答对是指问答系统中存储的每一组问题和对应的答案，也可以称为问答组。问答对是智能问答系统的核心，通过构建大量的问答对，系统可以学习如何根据用户的问题提供合适的回答。

FAQ是“Frequently Asked Questions”的缩写，即“常见问题解答”。FAQ是一个用于提供常见问题和相应答案的文件或页面，通常用于帮助用户自行查找解决办法，而不需要联系客服或提交工单。

特点：知识通常是封闭的，变化较为缓慢

CQA (Community Question Answer) 是指社区问答系统，是一种让用户在平台上提出问题并获得其他用户回答的系统。在CQA系统中，用户可以提出问题并回答其他用户的问题，从而形成一个社区化的知识分享平台。

CQA系统通常包含以下特点：
1. 用户生成内容：用户通过提问和回答的方式产生丰富的内容，共同构建起知识库。
2. 社区互动：用户可以对问题和答案进行投票、评论和讨论，推动优质内容的展现。
3. 专家认证：有些CQA系统会通过用户的积分、排名等方式评选出专家用户，提高专业知识的准确性。
4. 搜索和推荐功能：通过智能算法，CQA系统能够提供相关问题的搜索结果和推荐，方便用户查找所需信息。

知名的CQA系统包括Quora、Stack Overflow、知乎等，这些平台通过用户共享知识、讨论问题等方式，形成了庞大的社区用户群体，为用户提供了便捷的获取知识、解决问题的途径。

特点：问答对来自社区论坛中用户的提问和回答，较为容易获取，但是相对质量较低。问答对通常是面向开放域的，知识变化和更新速度较快。

问答流程：

1. 问题解析：对用户输入的问题进行分词、纠错等预处理步骤，主要是问题分类、关键词提取、关键词扩展
2. 召回：利用信息检索引擎根据处理后的问题提取可能的候选问题
3. 排序：利用信息检索模型对召回的候选问题进行相似度排序，寻找到最相似的问题答案并返回给用户

### 基于文本

问答流程：

1. 关键词提取、扩展
2. 信息检索：根据问题分析得到的关键词及其扩展形式从在线或者离线的文档库中检索到相关文档
3. 答案抽取：从检索得到的相关文档中抽取答案

### 基于知识图谱KBAQ

什么是知识图谱？

知识图谱是一种语义网络，用以抽象现实世界的实体、概念及关系，并以三元组的形式来表示知识。

知识图谱由三类元素构成：

- 实体（entity）
- 属性（literal）
- 关系（relation）

图谱数据的组织和存储：

- 图数据由节点和边组成
- 节点：表示现实世界中存在的实体或实体的属性
- 边：实体与实体之间的关系
- 关系不仅可以用于连接两个实体也可以连接实体和某属性

知识图谱可以使用图数据库如Neo4j存储。

基于知识图谱KBAQ问答流程：

- 问答系统解析输入的自然语言问句，抽取问句中的实体、关系和属性等信息
- 利用SPARQL生成查询语句，在知识图谱数据库中检索获得结果
- 基于检索结果生成回答


## 实例：RocketQA问答系统


# 对话系统

什么是对话系统？

对话系统通常指以自然语言为载体，用户和系统通过多轮交互实现特定交互目标的智能系统

对话系统的交互目标包括完成特定任务、获取信息、建议或推荐、获得情感抚慰和社交陪伴。

## 任务型对话系统

什么是任务型对话系统？

任务型对话系统是一种人工智能系统，旨在帮助用户完成特定任务或解决特定问题。与普通的对话系统不同，任务型对话系统更强调在对话中实现任务的目标。这种系统通常受到自然语言处理、机器学习和对话系统等领域的技术支持。

任务型对话系统的特点包括：

1. 目标导向：系统能够理解用户的任务目标，并与用户进行交互以实现这一目标，而不仅仅是进行闲聊或提供信息。

2. 自动化执行：系统能够执行用户请求的操作或查询，并返回对应的结果，如订票、查询天气、制定行程等。

3. 多轮对话：系统能够进行多轮对话，解决复杂的任务，需要持续交互确定用户需求。

4. 个性化服务：系统可以根据用户的偏好和历史信息提供个性化的服务和建议。

任务型对话系统在各个领域都有广泛的应用，例如在线客服、智能助手、智能家居控制系统等。这种系统能够提高工作效率，增强用户体验，帮助用户更快地完成任务。

任务型对话系统目的是使用尽可能少的对话轮数帮助用户完成预定任务或动作

大多数任务型对话系统对话数据规模较小，难以通过大量数据进行模型训练，前期需要手动制定的规则解决冷启动问题，这使得对话系统的构建变得昂贵和耗时，限制了对话系统在其他领域的使用。


## 自然语言理解NLU

自然语言理解任务：将自然语言文本或语音映射成可以执行用户期待动作的数据结构，以便计算机能够理解和处理

Schema：通常使用领域、意图、槽位等描述用户期待动作的数据结构

- 领域domain：领域范围，如天气、闹钟、音乐、火车票等；
- 意图intent：用户意图，如查天气、订火车票、退火车票等；
- 槽位slot：用户意图的相关属性信息，如火车票时间、出发地、目的地等

实现方法：

- 领域识别、意图识别：分类任务
- 槽值抽取：序列标注任务

端到端的NLU模型：集成三大任务

1. 输入用户问题，3个子任务共享编码
2. 基于【CLS】Token编码，判别领域、意图分类
3. 槽值抽取采用BIO标签识别
4. 梯度下降的loss采用3个子任务的loss和

性能评价

- 评估指标：准确率、精确率、召回率和F1 Score
- SA(Semantic Accuracy)：正确分析的句子数量所占比例，正确分析指正确预测了领域与意图，且正确预测了所有槽值（包括O标签）

常用数据集：ATIS



## 对话状态管理


### 对话状态跟踪（Dialogue State Track）

任务定义：

- 在对话过程中提取用户目标，并用一系列的槽值对来表示当前的对话状态
- 对话系统根据对话状态生成下一步系统动作，进而生成系统回复

评估指标：Joint Goal Accuracy（JGA）：对话状态预测正确的训练数据量占总训练数据量的比例

只有当一条训练数据中的所有槽值都预测正确，才认为该条数据的对话状态预测正确。

DST模型：Trade

- 编码：获得对话的文本表示
- 分类：判断某个槽是否取值
- 生成槽值：根据生成器生成槽值





# 基于大语言模型的问答

## 幻觉问题

常见幻觉：

- 与用户输入冲突的幻觉：大模型生成的回复违背了用户输入中的任务指示或任务输入
- 与已生成的上下文冲突的幻觉：大模型生成的回复中出现了自我矛盾
- 与事实知识冲突的幻觉：大模型生成的回复与公认的事实知识冲突

## 借用外部知识改善幻觉

外部知识：

- 无结构文本
- 结构化数据（网页或数据库）
- 各类工具

将检索到的相关知识提供给模型生成回复。在模型生成回复后，引入外部知识，让模型纠正先前回复中存在的幻觉。

## 外部知识问答LangChain

流程：

1. 将外部知识向量化，建立索引，保存到向量数据库中
2. 用户问题向量化，相似度检索
3. 基于检索结果内容与用户问题，生成提示，送入大模型，生成回答

## Prompt工程

提示工程：设计、改进、完善提示的学问或技术，使模型能够更准确、可靠地回答问题

提示语要素：

- 指令
- 上下文
- 输入数据
- 输出指示


## 面向领域问题的大模型训练方法

采用有监督的精调（Supervised Fine-tune， SFT）技术实现

预训练：采用领域文档训练行业文本的语言理解能力

指令精调：面向应用需求，训练任务处理能力